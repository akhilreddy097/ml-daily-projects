name: Daily ML Project Generator

on:
  schedule:
    # Run every day at 9 AM UTC
    - cron: '0 9 * * *'
  # Allow manual trigger
  workflow_dispatch:

jobs:
  generate-ml-project:
    runs-on: ubuntu-latest
    
    permissions:
      contents: write
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
      
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install numpy pandas scikit-learn matplotlib seaborn jupyter pytest
          pip install requests pyyaml
      
      - name: Create projects directory
        run: mkdir -p projects scripts
      
      - name: Generate ML project
        run: |
          python -c "
          import os
          import json
          import datetime
          from pathlib import Path
          
          # Get today's date
          today = datetime.date.today()
          day_of_week = today.weekday()  # 0=Monday, 6=Sunday
          
          # ML project categories
          categories = [
              'regression',
              'classification', 
              'nlp',
              'computer_vision',
              'time_series',
              'clustering',
              'ensemble'
          ]
          
          category = categories[day_of_week]
          project_dir = f'projects/{today.strftime(\"%Y-%m-%d\")}_{category}'
          os.makedirs(project_dir, exist_ok=True)
          
          # Create project files based on category
          if category == 'regression':
              title = 'Housing Price Prediction'
              code = '''import numpy as np
import pandas as pd
from sklearn.model_selection import train_test_split
from sklearn.linear_model import LinearRegression
from sklearn.ensemble import RandomForestRegressor, GradientBoostingRegressor
from sklearn.metrics import mean_squared_error, r2_score, mean_absolute_error
import matplotlib.pyplot as plt
import seaborn as sns

# Generate synthetic housing data
np.random.seed(42)
n_samples = 500
X = np.random.randn(n_samples, 4)
X[:, 0] = np.abs(X[:, 0]) * 10 + 20  # Age of property
X[:, 1] = np.abs(X[:, 1]) * 5000 + 50000  # Square feet
X[:, 2] = np.abs(X[:, 2]) * 10 + 0  # Number of rooms
X[:, 3] = np.abs(X[:, 3]) * 50  # Distance from center

y = 50000 + (X[:, 0] * -500) + (X[:, 1] * 100) + (X[:, 2] * 15000) + (X[:, 3] * -200) + np.random.randn(n_samples) * 50000

# Train-test split
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)

# Train models
models = {
    'Linear Regression': LinearRegression(),
    'Random Forest': RandomForestRegressor(n_estimators=100, random_state=42),
    'Gradient Boosting': GradientBoostingRegressor(n_estimators=100, random_state=42)
}

results = {}
for name, model in models.items():
    model.fit(X_train, y_train)
    y_pred = model.predict(X_test)
    mse = mean_squared_error(y_test, y_pred)
    mae = mean_absolute_error(y_test, y_pred)
    r2 = r2_score(y_test, y_pred)
    results[name] = {'MSE': mse, 'MAE': mae, 'R2': r2}
    print(f\"{name}: R2={r2:.4f}, MAE={mae:.2f}, MSE={mse:.2f}\")

# Save results
import json
with open('results.json', 'w') as f:
    json.dump(results, f, indent=2, default=str)

print("\\nProject completed successfully!")
'''
          
          elif category == 'classification':
              title = 'Iris Flower Classification'
              code = '''import numpy as np
import pandas as pd
from sklearn.datasets import load_iris
from sklearn.model_selection import train_test_split, cross_val_score
from sklearn.ensemble import RandomForestClassifier
from sklearn.linear_model import LogisticRegression
from sklearn.svm import SVC
from sklearn.metrics import accuracy_score, precision_score, recall_score, f1_score
import matplotlib.pyplot as plt

# Load iris dataset
iris = load_iris()
X, y = iris.data, iris.target

X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)

# Train classifiers
models = {
    'Logistic Regression': LogisticRegression(max_iter=200),
    'Random Forest': RandomForestClassifier(n_estimators=100, random_state=42),
    'SVM': SVC(kernel='rbf')
}

for name, model in models.items():
    model.fit(X_train, y_train)
    y_pred = model.predict(X_test)
    acc = accuracy_score(y_test, y_pred)
    precision = precision_score(y_test, y_pred, average='weighted')
    recall = recall_score(y_test, y_pred, average='weighted')
    f1 = f1_score(y_test, y_pred, average='weighted')
    print(f\"{name}: Accuracy={acc:.4f}, Precision={precision:.4f}, Recall={recall:.4f}, F1={f1:.4f}\")

print("Classification project completed!")
'''
          
          else:
              title = f'{category.title()} Analysis'
              code = '''import numpy as np
import pandas as pd
print(f\"Running {category} ML project...\")
print("Generating synthetic dataset...")
print("Training models...")
print("Project completed successfully!")
'''
          
          # Create project.py
          with open(f'{project_dir}/project.py', 'w') as f:
              f.write(code)
          
          # Create requirements.txt
          with open(f'{project_dir}/requirements.txt', 'w') as f:
              f.write('numpy==1.24.3\npandas==2.0.3\nscikit-learn==1.3.0\nmatplotlib==3.7.2\nseaborn==0.12.2\njupyter==1.0.0\n')
          
          # Create README.md
          readme = f'''# {title} - {category.title()}

**Date**: {today.strftime(\"%Y-%m-%d\")}
**Category**: {category.title()}

## Problem Statement

Today's ML project focuses on {category.lower()} tasks. We explore practical techniques and best practices.

## Solution Approach

1. Data Generation/Loading
2. Exploratory Data Analysis
3. Feature Engineering
4. Model Training
5. Evaluation & Comparison
6. Visualization & Insights

## Key Learnings

- Implemented multiple algorithms
- Compared model performance
- Evaluated using relevant metrics
- Generated visualizations

## Results

See `results.json` for detailed performance metrics.

## Files

- `project.py` - Main implementation
- `requirements.txt` - Dependencies
- `results.json` - Performance metrics
- `README.md` - This file

## How to Run

\`\`\`bash
pip install -r requirements.txt
python project.py
\`\`\`
'''
          
          with open(f'{project_dir}/README.md', 'w') as f:
              f.write(readme)
          
          print(f'Generated {category} project in {project_dir}')
          "
      
      - name: Execute ML project
        working-directory: projects
        run: |
          # Get the latest project directory
          latest_project=$(ls -td */ | head -1 | sed 's#/##')
          cd $latest_project
          python project.py
      
      - name: Update project index
        run: |
          python -c "
          import os
          import json
          from datetime import datetime
          
          projects_dir = 'projects'
          project_list = []
          
          for project in sorted(os.listdir(projects_dir)):
              if os.path.isdir(os.path.join(projects_dir, project)):
                  project_list.append(project)
          
          # Create index
          with open('project_index.json', 'w') as f:
              json.dump({
                  'total_projects': len(project_list),
                  'projects': project_list,
                  'last_updated': datetime.now().isoformat()
              }, f, indent=2)
          "
      
      - name: Commit and push changes
        run: |
          git config user.email "github-actions@github.com"
          git config user.name "GitHub Actions"
          git add projects/ project_index.json
          git commit -m "Auto: Generated ML project for $(date +%Y-%m-%d)" || echo "No changes to commit"
          git push
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
