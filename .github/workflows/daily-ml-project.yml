name: Daily ML Project Generator

on:
  schedule:
    - cron: '0 9 * * *'  # Run every day at 9 AM UTC
  workflow_dispatch:    # Allow manual trigger

jobs:
  generate-ml-project:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install numpy pandas scikit-learn matplotlib seaborn

      - name: Create projects directory
        run: mkdir -p projects

      - name: Generate ML project
        run: |
          python << 'EOF'
          import os
          import json
          import datetime
          
          today = datetime.date.today()
          day_of_week = today.weekday()
          
          categories = [
              'regression',
              'classification', 
              'nlp',
              'computer_vision',
              'time_series',
              'clustering',
              'ensemble'
          ]
          
          category = categories[day_of_week]
          project_dir = f'projects/{today.strftime("%Y-%m-%d")}_{category}'
          os.makedirs(project_dir, exist_ok=True)
          
          # Create sample project files
          project_code = f'''import numpy as np
import pandas as pd
from sklearn.model_selection import train_test_split
from sklearn.ensemble import RandomForestClassifier
from sklearn.metrics import accuracy_score

print("ML Project: {category.title()}")
print("Date: {today}")

# Generate sample data
X = np.random.randn(100, 4)
y = np.random.randint(0, 2, 100)

# Split and train
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2)
model = RandomForestClassifier()
model.fit(X_train, y_train)

# Evaluate
y_pred = model.predict(X_test)
accuracy = accuracy_score(y_test, y_pred)

print(f"Accuracy: {accuracy:.4f}")
print("\nProject completed successfully!")
'''
          
          with open(f'{project_dir}/project.py', 'w') as f:
              f.write(project_code)
          
          readme = f'''# {category.title()} Project

**Date**: {today}
**Category**: {category.title()}

## Description

Automatic {category.lower()} ML project generated on {today}.

## How to Run

```bash
python project.py
```

## Results

See execution logs for results.
'''
          
          with open(f'{project_dir}/README.md', 'w') as f:
              f.write(readme)
          
          req = '''numpy>=1.24.0
pandas>=2.0.0
scikit-learn>=1.3.0
matplotlib>=3.7.0
seaborn>=0.12.0
'''
          
          with open(f'{project_dir}/requirements.txt', 'w') as f:
              f.write(req)
          
          print(f'Generated {category} project in {project_dir}')
          EOF

      - name: Execute project
        run: |
          python projects/*/project.py

      - name: Configure git
        run: |
          git config user.email "github-actions@github.com"
          git config user.name "GitHub Actions"

      - name: Commit and push
        run: |
          git add projects/
          git commit -m "Auto: Generated ML project for $(date +%Y-%m-%d)" || echo "No changes"
          git push
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
